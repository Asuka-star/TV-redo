# version: '3.8' 已被移除，在新版中已过时

services:
  user-service:
    image: tv-redo-user-service:latest
    container_name: tv-redo-user-service
    build: ./user-service
    ports:
      - "8098:8098"
    networks:
      - microservices-network  # 链接到下面的别名

  gateway:
    image: tv-redo-gateway:latest
    container_name: tv-redo-gateway
    build: ./gateway
    ports:
      - "8090:8090"
    networks:
      - microservices-network

  comment-service:
    image: tv-redo-comment-service:latest
    container_name: tv-redo-comment-service
    build: ./comment-service
    ports:
      - "8099:8091"  # [保留] 你的端口冲突修复
    networks:
      - microservices-network

  shop-service:
    image: tv-redo-shop-service:latest
    container_name: tv-redo-shop-service
    build: ./shop-service
    ports:
      - "8096:8096"
    networks:
      - microservices-network

  thumb-service:
    image: tv-redo-thumb-service:latest
    container_name: tv-redo-thumb-service
    build: ./thumb-service
    ports:
      - "8097:8097"
    networks:
      - microservices-network

  follow-service:
    image: tv-redo-follow-service:latest
    container_name: tv-redo-follow-service
    build: ./follow-service
    ports:
      - "8094:8094"
    networks:
      - microservices-network

  post-service:
    image: tv-redo-post-service:latest
    container_name: tv-redo-post-service
    build: ./post-service
    ports:
      - "8095:8095"
    networks:
      - microservices-network

  favorite-service:
    image: tv-redo-favorite-service:latest
    container_name: tv-redo-favorite-service
    build: ./favorite-service
    ports:
      - "8093:8093"
    networks:
      - microservices-network

  coupon-service:
    image: tv-redo-coupon-service:latest
    container_name: tv-redo-coupon-service
    build: ./coupon-service
    ports:
      - "8092:8092"
    networks:
      - microservices-network

# [!! 核心修复 !!]
# 我们不再创建新网络，而是告诉 Compose 去使用一个已存在的网络
networks:
  microservices-network: # 这只是一个此文件内使用的“别名”
    external: true     # 告诉 Compose 这是个“外部”网络
    name: tv-net       # 这个外部网络的“真名”叫 tv-net